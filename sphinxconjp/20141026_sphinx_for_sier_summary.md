# SIerでもSphinxを使いたい！ 総括

## 2014/10/26 SphinxCon JP 2014

## @kk_Ataka

---

# 自己紹介

- Twitter: @kk_Ataka 
- GitHub:  gosyujin
- 普段いるところ
  - Kawasaki.rb, Jekyllrb-ja(主催)
- Python力
  - リファレンス片手じゃないとまだ書けない程度…

![75%, right](https://pbs.twimg.com/profile_images/2222065431/image.png)

---

# 発表の趣旨

- Kawasaki.rbというイベントで話した内容の総集編
- SIerでもSphinxを使いたい…ので職場で孤軍奮闘した備忘録
  - 利用事例
  - 拡張の紹介
- できたこと、できなかったこと含めて共有します

---

# 今日話さないこと

- Sphinxとはなんぞや
- reST記法とはなんぞや
- Sphinxを使ったドキュメント作成方法

---

# アジェンダ

- 競合ツールとの比較
- 導入のためのあれこれ、または導入後の課題

---

# 先に結論

- 競合ツールとの比較
  - ドキュメントを書くスピードは早いよ！(個人的に)
- 導入のためのあれこれ、または導入後の課題
- プロジェクト全体で「ドキュメントをSphinxで書いていく！」空気を作るのが難しい
  - そういうのがうまい人なら…個人的には、一人くらい好意的な「仲間」がいたら助かる
- メンバーにreST(またはMarkdown)を書いてもらうのが難しい
  - メリットをわかってもらう、慣例から脱却するまでが長い
- 納品物にするにはちょっと課題が多い

---

# 競合ツールとの比較

---

# Sphinxを入れたい！

- 導入するためには上の人を説得するための政治が必要…
- 競合ツールと比較してよさ気と思ったことを伝えていく
  - Office(Word, Excel)
  - Wiki, Markdown
  - Sphinx

---

# 比較1 Office(Word, Excel)

---

# Office 長所

- SI界のスタンダード
- WYSIWYGな操作
  - きめ細かいデザインが可能
  - 図やフローの挿入が容易
- 誰のPCにも入っていて、誰でも使える (という一般論)

---

# Office 短所

- あらゆるものがOfficeで作成され、共有サーバや添付ファイルにちらかる
  - もちろんチームによる、しかしセットでくる傾向は非常に高い
  - 伝説の「 **議事録\_20140505\_2(最新)(xx修正).xls** 」
- 検索性が非常に悪い
  - シート分かれてたり 吹出しに書かれてたり 非表示だったり

---

# Office 短所

- diffが取るのがメンドくさい
  - 取れないとは言ってない
- ミリ単位のレイアウト修正
  - 内容を集中して書かせて！
- あと重い(※ 個人的に)

---

# 番外

## Officeのいいところ

---

# Officeのいいところ

- ものすごく複雑な箇条書きが簡単(？)に作れる

```
  1.1. 方針
  1.2. スケジュール
    1.2.1. テスト1
      1.2.1.1. 詳細 #=> どこまで深く…
      ...           #=> そこに文章色々書いて…
    1.2.2. テスト2
  1.3. 役割分担     #=> からの復帰とか
```

---

# Officeのいいところ

- エグい表/テーブルが簡単(？)に作れる
  - 連結とかがすごいしてあるマトリクスのようなもの
- 値の計算(Excel)
  - これはExcelの独壇場、さすがは表計算ソフト
  - 表計算の用途にExcelを使うのは賛成

**適材適所が大事**

---

# 比較2 Wiki, Markdown

---

# Wiki, Markdown 長所

Officeで短所として挙げた問題は解消できる

      > あらゆるものがOfficeで作成され、共有サーバや添付ファイルにちらかる

- プレーンテキストで作成され、Wiki内などにちらかる
- 一応、Officeよりは探しやすいんじゃないかと思うのだが…

---

# Wiki, Markdown 長所

      > diffが取るのがメンドくさい

- Markdownはプレーンテキストなので簡単
- Wikiもだいたい差分表示機能あり

---

# Wiki, Markdown 長所

      > ミリ単位のレイアウト修正

- 出力先(htmlとcssなど)である程度統一できる
- アウトプットをブラウザで見ることを前提

---

# Wiki, Markdown 長所

加えて

- プレーンテキストなのでバージョン管理しやすい
- diff取りやすい

---

# Wiki, Markdown 短所

- 検索性はあまりよくない(気がする)
  - それでもOffice + 共有サーバコンボよりは…
- 重い
  - ただしサーバ性能とか同時アクセス数とかにもよる

---

# Wiki, Markdown 短所

他に、Officeでできたことが一部短所に

- 記法を覚える必要がある
- 「特定部分のみ」のレイアウト修正
  - cssなどに独自の処理を入れなければならない
- 図やフローの挿入はタグで挿入
  - D&Dとかで現物を見ながら直感的にいじれない

---

# 比較3 Sphinx

---

# Sphinx 長所

Wiki, Markdownの長所は引き継げる。プラス

- Sphinxには **体系的なドキュメントの骨組みを整えられる** 強力な機能がある
  - この辺をうまくやってくれているのがdoctree
  - のような気がする(まだ未調査)

---

# Sphinx 長所

また、Wiki, Markdownでつらかったことは解消されている

- 検索性はよい
  - 体系的にまとまるため
- 軽い
  - アウトプットがhtml, pdfなど
  - htmlをWebサーバに置けば静的ファイルを取ってくるのと変わらない

---

# Sphinx 短所

Wiki, Markdownと同様につらい

- 記法を覚える必要がある
- 「特定部分のみ」のレイアウト修正
  - cssなどに独自の処理を入れなければならない
- 図やフローの挿入はタグで挿入
  - D&Dとかで現物を見ながら直感的にいじれない

---

# ここまでのまとめ

- 慣れ親しんだOfficeから脱却したい、管理しやすい形式でドキュメント作成に挑戦してみよう
  - ならば Wiki, Markdown か Sphinx だ！
- TipsとかならWiki, Markdownでもいいけど、ドキュメントなのである程度体系的に管理したい
  - 体系的に管理するのが得意な Sphinx だ！

---

# 導入のためのあれこれ、または導入後の課題

---

# 導入するための壁

1. 対プロジェクトメンバー(PM)に対して
2. 対顧客に対して

![inline](https://cloud.githubusercontent.com/assets/588166/3563656/ac52d408-0a48-11e4-9013-aac931c21e40.png)

---

# 壁1. 対PM

---

# 対PM 登場人物

- 自分
  - Sphinxを導入したい人、基本的になんでもやる
- メンバー
  - 導入したSphinxを使ってほしい人
  - 油断するとすぐOfficeで日付バージョン管理@共有サーバする

---

# 対PM 「自分」の仕事

- **今回はreSTで進めることの明確な宣言**
  - **一番大事これができないと負の成果物が生成される…**
- メンバーが「特定のrstファイルを開いてドキュメント作成」に注力できる環境を作る
  - sphinx-quickstartで下準備
  - ドキュメント自体のアウトライン作成
  - doctreeの作成

---

# 対PM 「自分」の仕事

- あわせてビルド環境、デプロイ環境などもお膳立て
    - ビルドはJenkinsで拾う
    - デプロイはApacheにhtmlファイル配備だろうか

---

# 対PM 「メンバー」の仕事

- reST記法を覚えてもらう
  - Markdownならなんとか…って場合はMarkdown -> reSTという技もあるにはある
- バージョン管理ツールは使えてください…

---

# 対PM 課題

- ローカルPCでのプレビュー
  - Python, Sphinxを入れてもらうのは厳しい
  - 確認できるのがサーバにプッシュした時
  - ローカルでreSTプレビューできないだろうか…
      - GitHubだとできるんだけど

---

# 対PM 課題

- プロジェクト(会社)の風土にあわせたカスタマイズが必要かもしれない
  - 「変更履歴」出力プラグイン作ってみた
- sphinxcontrib-releasenotesプラグイン
  - .. releasenotes:: ディレクティブを追加したところにGitのコミットログと差分を貼り付け
  - Git使えない人用

---

![inline](https://cloud.githubusercontent.com/assets/588166/4243915/d0f9c750-3a16-11e4-96ba-375516fb44ee.png)

---

![inline](https://cloud.githubusercontent.com/assets/588166/4243916/d943b42a-3a16-11e4-8ca3-9dfd6249e3d1.png)

---

![inline](https://cloud.githubusercontent.com/assets/588166/4243918/e237b3b0-3a16-11e4-8890-1c93279fb57b.png)

---

# 壁2. 対顧客

---

# 対顧客 登場人物

- プロジェクト
  - 我々側。Sphinxでドキュメント納品します
- 顧客
  - ドキュメントを納品される側
  - 社内の人 or 社外の人
  - 歴史的経緯からOfficeで納品される事が多い
      - 例外はJavadocくらい？

---

# 対顧客 「プロジェクト」の仕事

- Sphinxで作成するドキュメントに関して「今回はOfficeじゃない形式でドキュメント書きますよ」の合意を得とく

---

# 対顧客 「顧客」の仕事

- 特になし？

---

# 対顧客 課題

- **納品形式** 最重要(次ページ参照)
  - 納品後誰が保守するのかが大事
  - 顧客が巻取ってしまう場合、どうやって保守すればよいのか
      - 今のところ、納品対象外となっているドキュメントだけSphinxを使うという方針しかない？
      - 要解決事項、誰かどうやってるか教えてください…

---

![inline](https://cloud.githubusercontent.com/assets/588166/3563987/1ac73444-0a65-11e4-929f-f5915950ba94.png)

---

# [fit] 色々考えた上で臨んだPJ

---

# 現状

- デモシステムのためドキュメントから何からすべて一任
- 紆余曲折があり開発担当が自分ほぼ一人になってしまった(リーダー的な人とかは別にいる)
  - やりたい放題ランド
  - 社内テンプレート(謎)仕込まれる前に前倒しでドキュメント作りまくり

---

# 現状

- バージョン管理、差分管理もできて快適
- 軽い(普通のエディタで編集してるから)
- 意外と営業の人に受けが良かった
  - 「え？なにこれ？なんてツール？あとで教えて」

---

# 現状

- Sphinx導入はできたが、思い描いていた事は実践できず…
  - ほぼ一人プロジェクトなので
- しかし、ドキュメント開発スピードなどは加速できている！(まったく定量的でない評価)
  - Office特有のもっさり感なし！
  - 履歴管理など気にする必要なし！

footer: ©2015 @kk_Ataka
slidenumbers: true
autoscale: true
build-lists: true
  
# Sphinx導入事例<br />〜SIerの場合〜

## 2015/10/31<br />JUS Sphinxワークショップ＠関西

---

# 自己紹介

- Twitter: @kk_Ataka
- GitHub: gosyujin
- SIer勤務
    - Sphinxはプライベートで利用しつつ、仕事にも組み込めないか試行錯誤中

![30% right](https://pbs.twimg.com/profile_images/2222065431/image.png) 

---

# アジェンダ

1. Sphinxを導入する前
    - 導入のための政治活動
1. Sphinx導入中、導入した後
    - 導入するにあたっての壁
    - 「納品」するには
1. Sphinxの導入事例

---

# Sphinxを導入する前

---

# はじめにSphinx(reST)の知名度調査

- 知名度0！
- Markdownもあんまり
- Wikiはかろうじて多少知られている

まずは政治から

---

# 競合ツールと比較！

- 競合ツールと比較しての良さを調査
    1. Office(Word, Excel)
    1. Wiki, Markdown

※ MarkdownはJekyllやHugoなどMarkdownで記述できる静的サイトジェネレータを想定しています

---

# 比較1 Office

---

# Office 長所

- SI界のスタンダード
- WYSIWYGな操作
    - きめ細かいデザインが可能
    - 図やフローの挿入が容易

---

# Office 長所

- ものすごく複雑な箇条書きが簡単(？)に作れる

```java
  1.1. 設計方針
  1.2. 開発スケジュール
    1.2.1. 要件定義   // => ネストしていく
      1.2.1.1. xx機能   // => さらにネスト…
      1.2.1.2. yy機能   // => 色々書いて…
    1.2.2. 基本設計   // => ネストからの復帰
  1.3. 開発体制       // => さらに復帰
```

---

# Office 長所

- エグい表/テーブルが簡単(？)に作れる
    - 連結、結合たくさんあるマトリクスのようなものとか
    - **Excel方眼紙フォーマット** で自由自在(泣)
- 値の計算が簡単
    - これはExcelの独壇場、さすがは表計算ソフト
    - 表計算の用途にExcelを使うのは賛成

---

# Office 短所

- diffが取るのがメンドくさい
    - 取れないとは言ってない、最近は取れるっぽい
    - 往々にして日付バージョン管理とくっつく事が多い
        - VCSと相性悪し
    - 恐怖の「 **議事録\_20140505\_2(最新)(xx修正).xls** 」

---

# Office 短所

- 検索しづらい
    - 違うシートとか、吹出しとか 非表示とか…探せない…
- ミリ単位のレイアウト修正を強いられる
    - 大事なのは内容…そうでしょ！
- 職人芸が発揮されるほど重い
    - 1GBオーバーのWordファイル…とか

---

# 比較2 Wiki, Markdown

---

# Wiki, Markdownの長所

Officeで短所として挙げた問題は解消できている！…と思う

---

# Wiki, Markdownの長所

```ruby
"diffが取るのがメンドくさい"
```

- Markdownはプレーンテキストなので簡単
    - バージョン管理もしやすい
- Wikiもだいたい差分表示機能あり
    - diff取りやすい

---

# Wiki, Markdownの長所

```ruby
"検索しづらい"
```

- Officeよりは探しやすいんじゃないかと思うのだが…
    - ブラウザ、エディタの検索とか、Wiki内検索とか

```ruby
"ミリ単位のレイアウト修正"
```

- 出力先(html+css、pdfなど)である程度統一できる

---

# Wiki, Markdownの短所

Officeでは特に意識していなかったことを考慮する必要あり

---

# Wiki, Markdownの短所

- 記法を覚える必要がある
    - 未経験者に敷居が高い…
    - 図やフローは基本的にタグで挿入
- 「特定部分のみ」のレイアウト修正が面倒
    - 独自の処理を入れる？面倒…

---

# Wiki, Markdownの短所

- しっかり作らないと情報が散らかる
    - いわゆるTips集になってしまう
- 方言が多い(特にMarkdown)
    - パーサが異なると出力結果が変わってしまう
    - 逆に考えると長所になり得る
- 出力はhtmlを想定しているものが多い

---

# そしてSphinx

---

# Sphinxの長所

- Wiki, Markdownの長所と短所はだいたいSphinxにも当てはまる
- Sphinxが強いところは…

---

# Sphinxだけの長所

- **体系的なドキュメント** の骨組みを **簡単に** 整えられる
    - これだけで導入する価値あり
    - 章の組み換え等も簡単
        - Wikiとかでこれを整備するのはちょっとしんどい…Office(Word)はちょっと得意かも
    - 実際に作ってみないと実感がわきづらいと思う

---

# Sphinxだけの長所

- 複数ページをまたぐのも得意
    - 索引ページ、用語集ページの作成も簡単
- html以外にも出力形式が豊富
    - text, pdf, epub, etc...

---

# Sphinx導入中<br />導入した後

---

# 導入するにあたっての壁

大きく2つ

1. 対プロジェクトメンバー(PM)に対して(布教)
2. 対顧客に対して(納品)

![inline](https://cloud.githubusercontent.com/assets/588166/3563656/ac52d408-0a48-11e4-9013-aac931c21e40.png)

---

# 壁1. 対PM

---

# 対PM 登場人物

1. 自分
  - Sphinxを導入したい人、基本的になんでもやる
1. メンバー
  - 導入したSphinxを使ってほしい人

---

# 対PM 「自分」の仕事

- **今回はreSTで進めることの明確な宣言とサポート**
  - 一番大事
  - これができないと負の成果物が生成される…

---

# 対PM 「自分」の仕事

- メンバーが「rstファイルを開いてドキュメント作成」に注力できる環境を作る
    1. sphinx-quickstartで下準備
    1. ドキュメント自体のアウトライン作成
    1. doctreeの作成

などなど

---

# 対PM 「自分」の仕事

- ビルド環境、デプロイ環境などもお膳立て
    - ビルドはJenkinsなどで拾う
    - デプロイはWebサーバにhtmlファイル配備とかがお手軽

---

# 対PM 「メンバー」の仕事

- とりあえずreST記法を覚えてもらう
- commitすれば(ビルド後)成果物が出来ることを周知

---

# 対PM 課題

- ローカルPCでのプレビュー
    - メンバーのPCにSphinxを入れてもらうのは厳しい…
        - 確認できるのがcommitした時のみになってしまう
    - ローカルで簡単にreSTプレビューできない
        - GitHubとか使えばある程度できるんだけど

---

# 対PM 課題

- プロジェクトの風土にあわせたカスタマイズが必要
    - こういうレイアウトがいい
    - こういうヘッダフッタがほしい
    - 社風にあわせて

---

# 壁2. 対顧客

---

# 対顧客 登場人物

1. プロジェクト
    - Sphinxでドキュメント納品する側
1. 顧客
    - ドキュメントを納品される側(社内の人 or 社外の人)
    - 歴史的経緯からOfficeで納品される事が多い
        - 例外はJavadocとか？

---

# 対顧客 「プロジェクト」側の仕事

- 顧客に対して宣言&合意を得る
    - 「今回はOfficeじゃない形式で設計書書きますよ」

---

# 対顧客 「顧客」側の仕事

- 特になし？心構えくらい？

---

# 対顧客 課題

- **納品形式** (次ページ参照)
  - 納品後 **「誰が」** 保守するのか
  - 顧客が巻取ってしまう場合、どう保守すればよいのか
      - 要解決事項
      - これがうまく解決できないと導入できない

---

# 「納品」するには…

---

![inline](https://cloud.githubusercontent.com/assets/588166/3563987/1ac73444-0a65-11e4-929f-f5915950ba94.png)

---

# 導入事例

---

# 環境

- 3ヶ月位のプロジェクトでSphinxを適用
    - ほぼ1人で設計、製造、テストを担当
        - 途中で1人サポートに入ってもらった
    - 環境は Sphinx + Git(VCS) + Jenkins(Build)
    - ターゲットは「社内資料」(顧客へ納品しない)

---

# 結果

1. Gitでバージョン管理、テキストなので差分管理も簡単！
1. 内容に集中できる！
1. お目当ての章が見やすい！探しやすい！
1. Outputは、意外と営業の人に受けが良かった！
    - 「え？なにこれ？なんてツール？あとで教えて」

---

# SIerにおけるSphinx導入の課題

1. 「Sphinxで書いていく！」空気を作るのが難しい
    - reSTで文章を書いてもらうのも難しい
    - 「仲間」がいてくれると助かる
1. 「納品」するにはまだ課題が多い
    - 解決の糸口は未だ見つからず…

footer: ©2015 @kk_Ataka
slidenumbers: true

# Sphinx導入事例<br />〜SIerの場合〜

## 2015/10/30<br />関西Sphinxワークショップ

---

# 自己紹介

- Twitter: @kk_Ataka 
- GitHub:  gosyujin
- SIer勤務

![75%, right](https://pbs.twimg.com/profile_images/2222065431/image.png)

---

# アジェンダ

1. Sphinxを導入する前
    - 導入のための政治(競合ツールとの比較)
    - 環境を作るために
1. Sphinxを導入した後
    - 「納品」するには

---

# 話さないこと

- Sphinxのインストール方法、使い方
- reST記法の書き方
    - ハンズオンでやっていきましょう

---

# Sphinxを導入する前

---

# Sphinxの知名度調査…

---

# 知名度0！

- Markdownもあんまり…
- Wikiはかろうじて
- まずは政治から

---

# 競合ツールとの比較！

- 競合ツールと比較しての良さを調査
    1. Office(Word, Excel)
    1. Wiki, Markdown
    1. Sphinx

---

# 比較1 Office

---

# Office 長所

- SI界のスタンダード
- WYSIWYGな操作
    - きめ細かいデザインが可能
    - 図やフローの挿入が容易
- 誰のPCにも入っていて、誰でも使える

---

# Office 長所

- ものすごく複雑な箇条書きが簡単(？)に作れる

```java
  1.1. 設計方針
  1.2. 開発スケジュール
    1.2.1. 要件定義   // => ネストしていく
      1.2.1.1. xx機能   // => さらにネスト…
      1.2.1.2. yy機能   // => 色々書いて…
    1.2.2. 基本設計   // => ネストからの復帰
  1.3. 開発体制       // => さらに復帰
```

---

# Office 長所

- エグい表/テーブルが簡単(？)に作れる
    - 連結、結合たくさんあるマトリクスのようなものとか
    - **Excel方眼紙フォーマット** で自由自在(泣)
- 値の計算が簡単
    - これはExcelの独壇場、さすがは表計算ソフト
    - 表計算の用途にExcelを使うのは賛成

---

# Office 短所

- あらゆるものがOfficeで作成され、至る所にちらかる
    - 日付バージョン管理…(VCSと相性悪し)
    - 恐怖の「 **議事録\_20140505\_2(最新)(xx修正).xls** 」
- 検索性が非常に悪い
    - 違うシートとか、吹出しとか 非表示とか…探せない…

---

# Office 短所

- diffが取るのがメンドくさい
    - 取れないとは言ってない、最近は取れるっぽい
- ミリ単位のレイアウト修正を強いられる
    - リストとかすぐ壊れる
    - 内容を集中して書かせて！
- (職人芸が発揮されるほど)重い

---

# 適材適所で使うと<br />強力なツール

---

# 比較2 Wiki, Markdown

---

# Wiki, Markdownの長所

Officeで短所として挙げた問題は解消できている！…と思う

---

# Wiki, Markdownの長所

```ruby
"あらゆるものがOfficeで作成され、至る所にちらかる"
```

- プレーンテキストで作成される
- Officeよりは探しやすいんじゃないかと思うのだが…
    - ブラウザ、エディタの検索とか、Wiki内検索とか

---

# Wiki, Markdownの長所

```ruby
"diffが取るのがメンドくさい"
```

- Markdownはプレーンテキストなので簡単
    - バージョン管理もしやすい
- Wikiもだいたい差分表示機能あり
    - diff取りやすい

---

# Wiki, Markdownの長所

```ruby
"ミリ単位のレイアウト修正"
```

- 出力先(html+css、pdfなど)である程度統一できる

---

# Wiki, Markdownの短所

Officeでは特に意識していなかったことを考慮する必要あり

---

# Wiki, Markdownの短所

- 記法を覚える必要がある
    - 未経験者に敷居が高い…
- 「特定部分のみ」のレイアウト修正
    - 独自の処理を入れる？面倒…
- 図やフローの挿入はタグで挿入
    - 直感的に編集できない

---

# Wiki, Markdownの短所

- 重い(特にWiki)
    - 体感としては Office > Wiki > Markdown > Sphinx
        - マシン/サーバ性能などにも依る
- しっかり作らないと情報が散らかる
    - いわゆるTips集になってしまう

---

# Wiki, Markdownの短所

- 方言が多い(特にMarkdown)
  - パーサが異なると出力結果が変わってしまう
- 出力はhtmlを想定しているものが多い

---

# 比較3 Sphinx

---

# Sphinxの長所

- Wiki, Markdownの長所と短所はだいたいSphinxにも当てはまる
- しかし、Sphinxが強い点あり

---

# Sphinxだけの長所

- 体系的なドキュメントの骨組みを **簡単に** 整えられる
    - これだけで導入する価値あり
    - 章の組み換え等も簡単
        - Wikiとかでこれを整備するのはちょっとしんどい…Office(Word)はちょっと得意かも
    - 実際に作ってみないと実感がわきづらいと思う

---

# Sphinxだけの長所

- html以外にも出力形式が豊富
    - text, pdf, epub, etc...

---

# Sphinx使ってみよう！

---

# 導入のためのあれこれ、または導入後の課題

---

# 導入するための壁

1. 対プロジェクトメンバー(PM)に対して(布教)
2. 対顧客に対して(納品)

![inline](https://cloud.githubusercontent.com/assets/588166/3563656/ac52d408-0a48-11e4-9013-aac931c21e40.png)

---

# 壁1. 対PM

---

# 対PM 登場人物

- 自分
  - Sphinxを導入したい人、基本的になんでもやる
- メンバー
  - 導入したSphinxを使ってほしい人

---

# 対PM 「自分」の仕事

- **今回はreSTで進めることの明確な宣言とサポート**
  - 一番大事
  - これができないと負の成果物が生成される…

---

# 対PM 「自分」の仕事

- メンバーが「rstファイルを開いてドキュメント作成」に注力できる環境を作る
  1. sphinx-quickstartで下準備
  2. ドキュメント自体のアウトライン作成
  3. doctreeの作成

などなど

---

# 対PM 「自分」の仕事

- ビルド環境、デプロイ環境などもお膳立て
    - ビルドはJenkinsなどで拾う
    - デプロイはApacheにhtmlファイル配備とか(お手軽)

---

# 対PM 「メンバー」の仕事

- reST記法を覚えてもらう
  - Markdown -> reST -> Outputという裏技もある(Pandoc経由)
  - バージョン管理ツールとかの話は…割愛

---

# 対PM 課題

- ローカルPCでのプレビュー
  - メンバーのPCにSphinxを入れてもらうのは厳しい…
  - そうすると、確認できるのがサーバにプッシュした時のみになってしまう
  - ローカルで簡単にreSTプレビューできないだろうか…
      - GitHubとか使えばある程度できるんだけど

---

# 対PM 課題

- プロジェクト(会社)の風土にあわせたカスタマイズが必要かも
  - こういうレイアウトがいい
  - こういうヘッダフッタがほしい
  - こういう改訂履歴ページがほしい

---

# 対PM 課題
  - 今回は「変更履歴」出力プラグイン作ってみた
- sphinxcontrib-releasenotesプラグイン
  - .. releasenotes:: ディレクティブを追加したところにGitのコミットログと差分を貼り付け
  - Git使えない人用

---

![inline](https://cloud.githubusercontent.com/assets/588166/4243915/d0f9c750-3a16-11e4-96ba-375516fb44ee.png)

---

![inline](https://cloud.githubusercontent.com/assets/588166/4243916/d943b42a-3a16-11e4-8ca3-9dfd6249e3d1.png)

---

![inline](https://cloud.githubusercontent.com/assets/588166/4243918/e237b3b0-3a16-11e4-8890-1c93279fb57b.png)

---

# 壁2. 対顧客

---

# 対顧客 登場人物

- プロジェクト
  - Sphinxでドキュメント納品する側
- 顧客 (社内の人 or 社外の人)
  - ドキュメントを納品される側
  - 歴史的経緯からOfficeで納品される事が多い
      - 例外はJavadocとか？

---

# 対顧客 「プロジェクト」側の仕事

- Sphinxで作成するドキュメントに関して「今回はOfficeじゃない形式で設計書とか書きますよ」の合意を得とく

---

# 対顧客 「顧客」側の仕事

- 特になし？心構えくらい？

---

# 対顧客 課題

- **納品形式** 最重要(次ページ参照)
  - 納品後 **「誰が」** 保守するのか
  - 顧客が巻取ってしまう場合、どう保守すればよいのか
      - 要解決事項、誰かどうやってるか教えてください…
      - これが解決できないと、Sphinxは納品対象外ドキュメントにしか適用できない…

---

![inline](https://cloud.githubusercontent.com/assets/588166/3563987/1ac73444-0a65-11e4-929f-f5915950ba94.png)

---

# 実際に導入してみた感想

---

# 環境

- 3ヶ月位のほぼ1人プロジェクトで「社内資料」をSphinx！
  - 社内資料なので、納品関係の課題はスルー
  - 環境揃えたい放題
      - Git + Sphinx + Jenkins etc
  - 途中で1人サポートに入ってもらった

---

# 結果

- Gitでバージョン管理、テキストなので差分管理も簡単！
- エディタが軽いので作成が快適！
- Outputからお目当ての章が見やすい！探しやすい！
- Outputは、意外と営業の人に受けが良かった！
  - 「え？なにこれ？なんてツール？あとで教えて」

---

# 結論

- 競合ツールとの比較
  - ドキュメントを書くスピードは早いよ！
- 導入のためのあれこれ、または導入後の課題
  - 「Sphinxで書いていく！」空気を作るのが難しい
  - 個人的には、「仲間(賛同者)」がいてくれると助かる

---

# 結論

- メンバーにreSTを書いてもらうのが難しい
  - メリットの周知、慣例からの脱却までが長い
- 納品物にするにはちょっと課題が多いかも
  - 今回解決の糸口は見つからず…
